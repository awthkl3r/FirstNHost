(function($,ot){typeof exports=="object"&&typeof module!="undefined"?ot(exports):typeof define=="function"&&define.amd?define(["exports"],ot):($=typeof globalThis!="undefined"?globalThis:$||self,ot($["@nhost/hasura-storage-js"]={}))})(this,function($){"use strict";function ot(e){var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(t,i);return new a}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}function Ge(e,t){return t=t||{},new Promise(function(r,n){var i=new XMLHttpRequest,a=[],o=[],s={},u=function(){return{ok:(i.status/100|0)==2,statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return a},entries:function(){return o},get:function(d){return s[d.toLowerCase()]},has:function(d){return d.toLowerCase()in s}}}};for(var f in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(d,c,h){a.push(c=c.toLowerCase()),o.push([c,h]),s[c]=s[c]?s[c]+","+h:h}),r(u())},i.onerror=n,i.withCredentials=t.credentials=="include",t.headers)i.setRequestHeader(f,t.headers[f]);i.send(t.body||null)})}const Vt=ot(Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"})));var Ut=self.fetch||(self.fetch=Vt.default||Vt);const qe=e=>{try{return btoa(e),e}catch{return encodeURIComponent(e)}},Bt=async(e,t,{accessToken:r,name:n,fileId:i,bucketId:a,adminSecret:o,onUploadProgress:s}={})=>{const u={};i&&(u["x-nhost-file-id"]=i),a&&(u["x-nhost-bucket-id"]=a),n&&(u["x-nhost-file-name"]=qe(n)),o&&(u["x-hasura-admin-secret"]=o),r&&(u.Authorization=`Bearer ${r}`);const f=`${e}/files`;if(typeof XMLHttpRequest=="undefined")try{const d=await Ut(f,{method:"POST",headers:u,body:t});return d.ok?{fileMetadata:await d.json(),error:null}:{error:{status:d.status,message:await d.text(),error:d.statusText},fileMetadata:null}}catch(d){return{error:{status:0,message:d.message,error:d.message},fileMetadata:null}}return new Promise(d=>{let c=new XMLHttpRequest;c.responseType="json",c.onload=()=>c.status<200&&c.status>=300?d({fileMetadata:null,error:{error:c.statusText,message:c.statusText,status:c.status}}):d({fileMetadata:c.response,error:null}),c.onerror=()=>d({fileMetadata:null,error:{error:c.statusText,message:c.statusText,status:c.status}}),s&&c.upload.addEventListener("progress",s,!1),c.open("POST",f,!0),Object.entries(u).forEach(([h,p])=>{c.setRequestHeader(h,p)}),c.send(t)})};class Kt{constructor({url:t}){this.url=t}async upload(t){const{formData:r}=t;return Bt(this.url,r,{accessToken:this.accessToken,adminSecret:this.adminSecret,bucketId:t.bucketId,fileId:t.id,name:t.name})}async getPresignedUrl(t){try{const{fileId:r}=t,n=await Ut(`${this.url}/files/${r}/presignedurl`,{method:"GET",headers:this.generateAuthHeaders()});if(!n.ok)throw new Error(await n.text());return{presignedUrl:await n.json(),error:null}}catch(r){return{presignedUrl:null,error:r}}}async delete(t){try{const{fileId:r}=t,n=await Ut(`${this.url}/files/${r}`,{method:"DELETE",headers:this.generateAuthHeaders()});if(!n.ok)throw new Error(await n.text());return{error:null}}catch(r){return{error:r}}}setAccessToken(t){return this.accessToken=t,this}setAdminSecret(t){return this.adminSecret=t,this}generateAuthHeaders(){if(!(!this.adminSecret&&!this.accessToken))return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}}var Qt=typeof self=="object"?self.FormData:window.FormData;function It(e,t){if(!t||Object.keys(t).length===0)return e;const r=new URL(e),n=Object.entries(t).reduce((i,[a,o])=>({...i,[a.charAt(0)]:o}),{});return Object.entries(n).forEach(([i,a])=>{a&&r.searchParams.set(i,a)}),r.toString()}class Je{constructor({url:t,adminSecret:r}){this.url=t,this.api=new Kt({url:t}),this.setAdminSecret(r)}async upload(t){let r;return"file"in t?(r=new Qt,r.append("file",t.file)):r=t.formData,this.api.upload({...t,formData:r})}getPublicUrl(t){const{fileId:r,...n}=t;return It(`${this.url}/files/${r}`,n)}async getPresignedUrl(t){const{fileId:r,...n}=t,{presignedUrl:i,error:a}=await this.api.getPresignedUrl(t);if(a)return{presignedUrl:null,error:a};if(!i)return{presignedUrl:null,error:new Error("Invalid file id")};const o=It(i.url,n);return{presignedUrl:{...i,url:o},error:null}}async delete(t){const{error:r}=await this.api.delete(t);return r?{error:r}:{error:null}}setAccessToken(t){return this.api.setAccessToken(t),this}setAdminSecret(t){return this.api.setAdminSecret(t),this}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var l=function(){return l=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},l.apply(this,arguments)};function Mt(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function b(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function P(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}var O;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(O||(O={}));var Y;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(Y||(Y={}));var Ft=O.Start,$t=O.Stop,K=O.Raise,st=O.Send,Zt=O.Cancel,te=O.NullEvent,gt=O.Assign,Ye=O.After,Xe=O.DoneState,Ct=O.Log,ee=O.Init,mt=O.Invoke,We=O.ErrorExecution,Ve=O.ErrorPlatform,re=O.ErrorCustom,_t=O.Update,ne=O.Choose,ie=O.Pure;const Be=Object.freeze(Object.defineProperty({__proto__:null,after:Ye,assign:gt,cancel:Zt,choose:ne,doneState:Xe,error:re,errorExecution:We,errorPlatform:Ve,init:ee,invoke:mt,log:Ct,nullEvent:te,pure:ie,raise:K,send:st,start:Ft,stop:$t,update:_t},Symbol.toStringTag,{value:"Module"}));var ae=".",oe={},kt="xstate.guard",Ke="",C=process.env.NODE_ENV==="production",St;function Ht(e,t,r){r===void 0&&(r=ae);var n=ut(e,r),i=ut(t,r);return E(i)?E(n)?i===n:!1:E(n)?n in i:Object.keys(n).every(function(a){return a in i?Ht(n[a],i[a]):!1})}function se(e){try{return E(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function zt(e,t){try{return lt(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function Qe(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function ut(e,t){if(Qe(e))return e.value;if(lt(e))return wt(e);if(typeof e!="string")return e;var r=zt(e,t);return wt(r)}function wt(e){if(e.length===1)return e[0];for(var t={},r=t,n=0;n<e.length-1;n++)n===e.length-2?r[e[n]]=e[n+1]:(r[e[n]]={},r=r[e[n]]);return t}function ft(e,t){for(var r={},n=Object.keys(e),i=0;i<n.length;i++){var a=n[i];r[a]=t(e[a],a,e,i)}return r}function ue(e,t,r){var n,i,a={};try{for(var o=b(Object.keys(e)),s=o.next();!s.done;s=o.next()){var u=s.value,f=e[u];r(f)&&(a[u]=t(f,u,e))}}catch(d){n={error:d}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}var Ze=function(e){return function(t){var r,n,i=t;try{for(var a=b(e),o=a.next();!o.done;o=a.next()){var s=o.value;i=i[s]}}catch(u){r={error:u}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i}};function tr(e,t){return function(r){var n,i,a=r;try{for(var o=b(e),s=o.next();!s.done;s=o.next()){var u=s.value;a=a[t][u]}}catch(f){n={error:f}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}}function xt(e){if(!e)return[[]];if(E(e))return[[e]];var t=j(Object.keys(e).map(function(r){var n=e[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:xt(e[r]).map(function(i){return[r].concat(i)})}));return t}function j(e){var t;return(t=[]).concat.apply(t,P([],x(e),!1))}function fe(e){return lt(e)?e:[e]}function k(e){return e===void 0?[]:fe(e)}function le(e,t,r){var n,i;if(N(e))return e(t,r.data);var a={};try{for(var o=b(Object.keys(e)),s=o.next();!s.done;s=o.next()){var u=s.value,f=e[u];N(f)?a[u]=f(t,r.data):a[u]=f}}catch(d){n={error:d}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function er(e){return/^(done|error)\./.test(e)}function rr(e,t){var r,n,i=x([[],[]],2),a=i[0],o=i[1];try{for(var s=b(e),u=s.next();!u.done;u=s.next()){var f=u.value;t(f)?a.push(f):o.push(f)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return[a,o]}function ce(e,t){return ft(e.states,function(r,n){if(r){var i=(E(t)?void 0:t[n])||(r?r.current:void 0);if(i)return{current:i,states:ce(r,i)}}})}function nr(e,t){return{current:t,states:ce(e,t)}}function de(e,t,r,n){C||q(!!e,"Attempting to update undefined context");var i=e&&r.reduce(function(a,o){var s,u,f=o.assignment,d={state:n,action:o,_event:t},c={};if(N(f))c=f(a,t.data,d);else try{for(var h=b(Object.keys(f)),p=h.next();!p.done;p=h.next()){var y=p.value,g=f[y];c[y]=N(g)?g(a,t.data,d):g}}catch(S){s={error:S}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}return Object.assign({},a,c)},e);return i}var q=function(){};C||(q=function(e,t){var r=e instanceof Error?e:void 0;if(!(!r&&e)&&console!==void 0){var n=["Warning: ".concat(t)];r&&n.push(r),console.warn.apply(console,n)}});function lt(e){return Array.isArray(e)}function N(e){return typeof e=="function"}function E(e){return typeof e=="string"}function he(e,t){if(e)return E(e)?{type:kt,name:e,predicate:t?t[e]:void 0}:N(e)?{type:kt,name:e.name,predicate:e}:e}var ve=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();St={},St[ve]=function(){return this},St[Symbol.observable]=function(){return this};function B(e){return!!e&&"__xstatenode"in e}var ir=function(){var e=0;return function(){return e++,e.toString(16)}}();function pe(e,t){return E(e)||typeof e=="number"?l({type:e},t):e}function ct(e,t){if(!E(e)&&"$$type"in e&&e.$$type==="scxml")return e;var r=pe(e);return l({name:r.type,data:r,$$type:"scxml",type:"external"},t)}function Q(e,t){var r=fe(t).map(function(n){return typeof n=="undefined"||typeof n=="string"||B(n)?{target:n,event:e}:l(l({},n),{event:e})});return r}function ar(e){if(!(e===void 0||e===Ke))return k(e)}function ye(e,t,r,n,i){var a=e.options.guards,o={state:i,cond:t,_event:n};if(t.type===kt)return((a==null?void 0:a[t.name])||t.predicate)(r,n.data,o);var s=a==null?void 0:a[t.type];if(!s)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return s(r,n.data,o)}function or(e){return typeof e=="string"?{type:e}:e}function Et(e,t){return"".concat(e,":invocation[").concat(t,"]")}var Ot=ct({type:ee});function Gt(e,t){return t&&t[e]||void 0}function Z(e,t){var r;if(E(e)||typeof e=="number"){var n=Gt(e,t);N(n)?r={type:e,exec:n}:n?r=n:r={type:e,exec:void 0}}else if(N(e))r={type:e.name||e.toString(),exec:e};else{var n=Gt(e.type,t);if(N(n))r=l(l({},e),{exec:n});else if(n){var i=n.type||e.type;r=l(l(l({},n),e),{type:i})}else r=e}return r}var X=function(e,t){if(!e)return[];var r=lt(e)?e:[e];return r.map(function(n){return Z(n,t)})};function At(e){var t=Z(e);return l(l({id:E(e)?e:t.id},t),{type:t.type})}function ge(e){return E(e)?{type:K,event:e}:W(e,{to:Y.Internal})}function me(e){return{type:K,_event:ct(e.event)}}function W(e,t){return{to:t?t.to:void 0,type:st,event:N(e)?e:pe(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:N(e)?e.name:se(e)}}function Se(e,t,r,n){var i={_event:r},a=ct(N(e.event)?e.event(t,r.data,i):e.event),o;if(E(e.delay)){var s=n&&n[e.delay];o=N(s)?s(t,r.data,i):s}else o=N(e.delay)?e.delay(t,r.data,i):e.delay;var u=N(e.to)?e.to(t,r.data,i):e.to;return l(l({},e),{to:u,_event:a,event:a.data,delay:o})}function qt(e,t){return W(e,l(l({},t),{to:Y.Parent}))}function sr(e,t,r){return W(t,l(l({},r),{to:e}))}function ur(){return qt(_t)}function fr(e,t){return W(e,l(l({},t),{to:function(r,n,i){var a=i._event;return a.origin}}))}var lr=function(e,t){return{context:e,event:t}};function cr(e,t){return e===void 0&&(e=lr),{type:Ct,label:t,expr:e}}var we=function(e,t,r){return l(l({},e),{value:E(e.expr)?e.expr:e.expr(t,r.data,{_event:r})})},xe=function(e){return{type:Zt,sendId:e}};function Ee(e){var t=At(e);return{type:O.Start,activity:t,exec:void 0}}function Oe(e){var t=N(e)?e:At(e);return{type:O.Stop,activity:t,exec:void 0}}function Ae(e,t,r){var n=N(e.activity)?e.activity(t,r.data):e.activity,i=typeof n=="string"?{id:n}:n,a={type:O.Stop,activity:i};return a}var Pe=function(e){return{type:gt,assignment:e}};function dr(e){return typeof e=="object"&&"type"in e}function be(e,t){var r=t?"#".concat(t):"";return"".concat(O.After,"(").concat(e,")").concat(r)}function dt(e,t){var r="".concat(O.DoneState,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function Te(e,t){var r="".concat(O.DoneInvoke,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function je(e,t){var r="".concat(O.ErrorPlatform,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function hr(e){return{type:O.Pure,get:e}}function vr(e,t){if(!C&&(!e||typeof e=="function")){var r=e;e=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=typeof r=="function"?r.apply(void 0,P([],x(n),!1)):r;if(!a)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return a}}return W(function(n,i){return i},l(l({},t),{to:e}))}function pr(e,t){return qt(function(r,n,i){return{type:re,data:N(e)?e(r,n,i):e}},l(l({},t),{to:Y.Parent}))}function yr(e){return{type:O.Choose,conds:e}}var gr=function(e){var t,r,n=[];try{for(var i=b(e),a=i.next();!a.done;a=i.next())for(var o=a.value,s=0;s<o.length;){if(o[s].type===gt){n.push(o[s]),o.splice(s,1);continue}s++}}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n};function Pt(e,t,r,n,i,a,o){o===void 0&&(o=!1);var s=o?[]:gr(i),u=s.length?de(r,n,s,t):r,f=o?[r]:void 0,d=[];function c(y){var g;switch(y.type){case K:return me(y);case st:var S=Se(y,u,n,e.options.delays);return C||q(!E(y.delay)||typeof S.delay=="number","No delay reference for delay expression '".concat(y.delay,"' was found on machine '").concat(e.id,"'")),a&&S.to!==Y.Internal&&d.push(S),S;case Ct:{var A=we(y,u,n);return a==null||a(A,u,n),A}case ne:{var v=y,w=(g=v.conds.find(function(z){var J=he(z.cond,e.options.guards);return!J||ye(e,J,u,n,a?void 0:t)}))===null||g===void 0?void 0:g.actions;if(!w)return[];var R=x(Pt(e,t,u,n,[X(k(w),e.options.actions)],a,o),2),D=R[0],L=R[1];return u=L,f==null||f.push(u),D}case ie:{var w=y.get(u,n.data);if(!w)return[];var I=x(Pt(e,t,u,n,[X(k(w),e.options.actions)],a,o),2),U=I[0],_=I[1];return u=_,f==null||f.push(u),U}case $t:{var A=Ae(y,u,n);return a==null||a(A,r,n),A}case gt:{u=de(u,n,[y],a?void 0:t),f==null||f.push(u);break}default:var m=Z(y,e.options.actions),T=m.exec;if(a)a(m,u,n);else if(T&&f){var H=f.length-1;m=l(l({},m),{exec:function(z){for(var J=[],nt=1;nt<arguments.length;nt++)J[nt-1]=arguments[nt];T.apply(void 0,P([f[H]],x(J),!1))}})}return m}}function h(y){var g,S,A=[];try{for(var v=b(y),w=v.next();!w.done;w=v.next()){var R=w.value,D=c(R);D&&(A=A.concat(D))}}catch(L){g={error:L}}finally{try{w&&!w.done&&(S=v.return)&&S.call(v)}finally{if(g)throw g.error}}return d.forEach(function(L){a(L,u,n)}),d.length=0,A}var p=j(i.map(h));return[p,u]}const mr=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:Be,after:be,assign:Pe,cancel:xe,choose:yr,done:dt,doneInvoke:Te,error:je,escalate:pr,forwardTo:vr,getActionFunction:Gt,initEvent:Ot,isActionObject:dr,log:cr,pure:hr,raise:ge,resolveActions:Pt,resolveLog:we,resolveRaise:me,resolveSend:Se,resolveStop:Ae,respond:fr,send:W,sendParent:qt,sendTo:sr,sendUpdate:ur,start:Ee,stop:Oe,toActionObject:Z,toActionObjects:X,toActivityDefinition:At},Symbol.toStringTag,{value:"Module"}));var bt=[],Sr=function(e,t){bt.push(e);var r=t(e);return bt.pop(),r},wr=function(e){return e(bt[bt.length-1])};function De(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[ve]=function(){return this},t}function xr(e,t,r,n){var i,a=or(e.src),o=(i=t==null?void 0:t.options.services)===null||i===void 0?void 0:i[a.type],s=e.data?le(e.data,r,n):void 0,u=o?Ne(o,e.id,s):De(e.id);return u.meta=e,u}function Ne(e,t,r){var n=De(t);if(n.deferred=!0,B(e)){var i=n.state=Sr(void 0,function(){return(r?e.withContext(r):e).initialState});n.getSnapshot=function(){return i}}return n}var Tt=function(e){return e.type==="atomic"||e.type==="final"};function Re(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function ht(e){return Re(e).filter(function(t){return t.type!=="history"})}function Le(e){var t=[e];return Tt(e)?t:t.concat(j(ht(e).map(Le)))}function vt(e,t){var r,n,i,a,o,s,u,f,d=new Set(e),c=Jt(d),h=new Set(t);try{for(var p=b(h),y=p.next();!y.done;y=p.next())for(var g=y.value,S=g.parent;S&&!h.has(S);)h.add(S),S=S.parent}catch(_){r={error:_}}finally{try{y&&!y.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}var A=Jt(h);try{for(var v=b(h),w=v.next();!w.done;w=v.next()){var g=w.value;if(g.type==="compound"&&(!A.get(g)||!A.get(g).length))c.get(g)?c.get(g).forEach(function(m){return h.add(m)}):g.initialStateNodes.forEach(function(m){return h.add(m)});else if(g.type==="parallel")try{for(var R=(o=void 0,b(ht(g))),D=R.next();!D.done;D=R.next()){var L=D.value;h.has(L)||(h.add(L),c.get(L)?c.get(L).forEach(function(m){return h.add(m)}):L.initialStateNodes.forEach(function(m){return h.add(m)}))}}catch(m){o={error:m}}finally{try{D&&!D.done&&(s=R.return)&&s.call(R)}finally{if(o)throw o.error}}}}catch(_){i={error:_}}finally{try{w&&!w.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}try{for(var I=b(h),U=I.next();!U.done;U=I.next())for(var g=U.value,S=g.parent;S&&!h.has(S);)h.add(S),S=S.parent}catch(_){u={error:_}}finally{try{U&&!U.done&&(f=I.return)&&f.call(I)}finally{if(u)throw u.error}}return h}function Ue(e,t){var r=t.get(e);if(!r)return{};if(e.type==="compound"){var n=r[0];if(n){if(Tt(n))return n.key}else return{}}var i={};return r.forEach(function(a){i[a.key]=Ue(a,t)}),i}function Jt(e){var t,r,n=new Map;try{for(var i=b(e),a=i.next();!a.done;a=i.next()){var o=a.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n}function Er(e,t){var r=vt([e],t);return Ue(e,Jt(r))}function pt(e,t){return Array.isArray(e)?e.some(function(r){return r===t}):e instanceof Set?e.has(t):!1}function Or(e){return P([],x(new Set(j(P([],x(e.map(function(t){return t.ownEvents})),!1)))),!1)}function jt(e,t){return t.type==="compound"?ht(t).some(function(r){return r.type==="final"&&pt(e,r)}):t.type==="parallel"?ht(t).every(function(r){return jt(e,r)}):!1}function Ar(e){return e===void 0&&(e=[]),e.reduce(function(t,r){return r.meta!==void 0&&(t[r.id]=r.meta),t},{})}function Ie(e){return new Set(j(e.map(function(t){return t.tags})))}function Me(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(E(e)||E(t))return e===t;var r=Object.keys(e),n=Object.keys(t);return r.length===n.length&&r.every(function(i){return Me(e[i],t[i])})}var V=function(){function e(t){var r=this,n;this.actions=[],this.activities=oe,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||oe,this.meta=Ar(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(n=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&n!==void 0?n:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Or(r.configuration)}})}return e.from=function(t,r){if(t instanceof e)return t.context!==r?new e({value:t.value,context:r,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var n=Ot;return new e({value:t,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,r){if(t instanceof e){if(!t.actions.length)return t;var n=Ot;return new e({value:t.value,context:r,_event:n,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,r)},e.prototype.toStrings=function(t,r){var n=this;if(t===void 0&&(t=this.value),r===void 0&&(r="."),E(t))return[t];var i=Object.keys(t);return i.concat.apply(i,P([],x(i.map(function(a){return n.toStrings(t[a],r).map(function(o){return a+r+o})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var r=t.tags;t.machine;var n=Mt(t,["configuration","transitions","tags","machine"]);return l(l({},n),{tags:Array.from(r)})},e.prototype.matches=function(t){return Ht(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var r;C&&q(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,t);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},e}(),Fe={sync:!1,autoForward:!1},$e;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})($e||($e={}));var Pr=function(e){return E(e)?l(l({},Fe),{name:e}):l(l(l({},Fe),{name:ir()}),e)};function br(e,t){var r=Pr(t);return wr(function(n){if(!C){var i=B(e)||N(e);q(!!n||i,'Attempted to spawn an Actor (ID: "'.concat(B(e)?e.id:"undefined",'") outside of a service. This will have no effect.'))}return n?n.spawn(e,r.name,r):Ne(e,r.name)})}function Tr(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function Dt(e){return l(l({type:mt},e),{toJSON:function(){e.onDone,e.onError;var t=Mt(e,["onDone","onError"]);return l(l({},t),{type:mt,src:Tr(e.src)})}})}var tt="",Yt="#",yt="*",et={},rt=function(e){return e[0]===Yt},jr=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Dr=function(e,t,r){var n=r.slice(0,-1).some(function(a){return!("cond"in a)&&!("in"in a)&&(E(a.target)||B(a.target))}),i=t===tt?"the transient event":"event '".concat(t,"'");q(!n,"One or more transitions for ".concat(i," on state '").concat(e.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},Nr=function(){function e(t,r,n,i){n===void 0&&(n="context"in t?t.context:void 0);var a=this,o;this.config=t,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(jr(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:ae),this.id=this.config.id||P([this.machine.key],x(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,C||q(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?ft(this.config.states,function(f,d){var c,h=new e(f,{},void 0,{parent:a,key:d});return Object.assign(a.idMap,l((c={},c[h.id]=h,c),h.idMap)),h}):et;var s=0;function u(f){var d,c;f.order=s++;try{for(var h=b(Re(f)),p=h.next();!p.done;p=h.next()){var y=p.value;u(y)}}catch(g){d={error:g}}finally{try{p&&!p.done&&(c=h.return)&&c.call(h)}finally{if(d)throw d.error}}}u(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var d=f.event;return d===tt}):tt in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=k(this.config.entry||this.config.onEntry).map(function(f){return Z(f)}),this.onExit=k(this.config.exit||this.config.onExit).map(function(f){return Z(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=k(this.config.invoke).map(function(f,d){var c,h;if(B(f)){var p=Et(a.id,d);return a.machine.options.services=l((c={},c[p]=f,c),a.machine.options.services),Dt({src:p,id:p})}else if(E(f.src)){var p=f.id||Et(a.id,d);return Dt(l(l({},f),{id:p,src:f.src}))}else if(B(f.src)||N(f.src)){var p=f.id||Et(a.id,d);return a.machine.options.services=l((h={},h[p]=f.src,h),a.machine.options.services),Dt(l(l({id:p},f),{src:p}))}else{var y=f.src;return Dt(l(l({id:Et(a.id,d)},f),{src:y}))}}),this.activities=k(this.config.activities).concat(this.invoke).map(function(f){return At(f)}),this.transition=this.transition.bind(this),this.tags=k(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||Le(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,r){var n=this.options,i=n.actions,a=n.activities,o=n.guards,s=n.services,u=n.delays;return new e(this.config,{actions:l(l({},i),t.actions),activities:l(l({},a),t.activities),guards:l(l({},o),t.guards),services:l(l({},s),t.services),delays:l(l({},u),t.delays)},r!=null?r:this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return N(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ft(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var r=t===tt,n=this.transitions.filter(function(i){var a=i.eventType===t;return r?a:a||i.eventType===yt});return this.__cache.candidates[t]=n,n},e.prototype.getDelayedTransitions=function(){var t=this,r=this.config.after;if(!r)return[];var n=function(a,o){var s=N(a)?"".concat(t.id,":delay[").concat(o,"]"):a,u=be(s,t.id);return t.onEntry.push(W(u,{delay:a})),t.onExit.push(xe(u)),u},i=lt(r)?r.map(function(a,o){var s=n(a.delay,o);return l(l({},a),{event:s})}):j(Object.keys(r).map(function(a,o){var s=r[a],u=E(s)?{target:s}:s,f=isNaN(+a)?a:+a,d=n(f,o);return k(u).map(function(c){return l(l({},c),{event:d,delay:f})})}));return i.map(function(a){var o=a.delay;return l(l({},t.formatTransition(a)),{delay:o})})},e.prototype.getStateNodes=function(t){var r,n=this;if(!t)return[];var i=t instanceof V?t.value:ut(t,this.delimiter);if(E(i)){var a=this.getStateNode(i).initial;return a!==void 0?this.getStateNodes((r={},r[i]=a,r)):[this,this.states[i]]}var o=Object.keys(i),s=[this];return s.push.apply(s,P([],x(j(o.map(function(u){return n.getStateNode(u).getStateNodes(i[u])}))),!1)),s},e.prototype.handles=function(t){var r=se(t);return this.events.includes(r)},e.prototype.resolveState=function(t){var r=t instanceof V?t:V.create(t),n=Array.from(vt([],this.getStateNodes(r.value)));return new V(l(l({},r),{value:this.resolve(r.value),configuration:n,done:jt(n,this),tags:Ie(n),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,r,n){var i=this.getStateNode(t),a=i.next(r,n);return!a||!a.transitions.length?this.next(r,n):a},e.prototype.transitionCompoundNode=function(t,r,n){var i=Object.keys(t),a=this.getStateNode(i[0]),o=a._transition(t[i[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},e.prototype.transitionParallelNode=function(t,r,n){var i,a,o={};try{for(var s=b(Object.keys(t)),u=s.next();!u.done;u=s.next()){var f=u.value,d=t[f];if(d){var c=this.getStateNode(f),h=c._transition(d,r,n);h&&(o[f]=h)}}}catch(v){i={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}var p=Object.keys(o).map(function(v){return o[v]}),y=j(p.map(function(v){return v.transitions})),g=p.some(function(v){return v.transitions.length>0});if(!g)return this.next(r,n);var S=j(p.map(function(v){return v.entrySet})),A=j(Object.keys(o).map(function(v){return o[v].configuration}));return{transitions:y,entrySet:S,exitSet:j(p.map(function(v){return v.exitSet})),configuration:A,source:r,actions:j(Object.keys(o).map(function(v){return o[v].actions}))}},e.prototype._transition=function(t,r,n){return E(t)?this.transitionLeafNode(t,r,n):Object.keys(t).length===1?this.transitionCompoundNode(t,r,n):this.transitionParallelNode(t,r,n)},e.prototype.getTransitionData=function(t,r){return this._transition(t.value,t,ct(r))},e.prototype.next=function(t,r){var n,i,a=this,o=r.name,s=[],u=[],f;try{for(var d=b(this.getCandidates(o)),c=d.next();!c.done;c=d.next()){var h=c.value,p=h.cond,y=h.in,g=t.context,S=y?E(y)&&rt(y)?t.matches(ut(this.getStateNodeById(y).path,this.delimiter)):Ht(ut(y,this.delimiter),Ze(this.path.slice(0,-2))(t.value)):!0,A=!1;try{A=!p||ye(this.machine,p,g,r,t)}catch(D){throw new Error("Unable to evaluate guard '".concat(p.name||p.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(D.message))}if(A&&S){h.target!==void 0&&(u=h.target),s.push.apply(s,P([],x(h.actions),!1)),f=h;break}}}catch(D){n={error:D}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}if(f){if(!u.length)return{transitions:[f],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:s};var v=j(u.map(function(D){return a.getRelativeStateNodes(D,t.historyValue)})),w=!!f.internal,R=[];return w||u.forEach(function(D){R.push.apply(R,P([],x(a.getExternalReentryNodes(D)),!1))}),{transitions:[f],entrySet:R,exitSet:w?[]:[this],configuration:v,source:t,actions:s}}},e.prototype.getExternalReentryNodes=function(t){for(var r=[],n=x(t.order>this.order?[t,this]:[this,t],2),i=n[0],a=n[1];i&&i!==a;)r.push(i),i=i.parent;return i!==a?[]:(r.push(a),r)},e.prototype.getActions=function(t,r,n,i,a,o,s){var u,f,d,c,h=this,p=vt([],o?this.getStateNodes(o.value):[this]);try{for(var y=b(t),g=y.next();!g.done;g=y.next()){var S=g.value;(!pt(p,S)||pt(n.entrySet,S.parent))&&n.entrySet.push(S)}}catch(m){u={error:m}}finally{try{g&&!g.done&&(f=y.return)&&f.call(y)}finally{if(u)throw u.error}}try{for(var A=b(p),v=A.next();!v.done;v=A.next()){var S=v.value;(!pt(t,S)||pt(n.exitSet,S.parent))&&n.exitSet.push(S)}}catch(m){d={error:m}}finally{try{v&&!v.done&&(c=A.return)&&c.call(A)}finally{if(d)throw d.error}}var w=j(n.entrySet.map(function(m){var T=[];if(m.type!=="final")return T;var H=m.parent;if(!H.parent)return T;T.push(dt(m.id,m.doneData),dt(H.id,m.doneData?le(m.doneData,i,a):void 0));var z=H.parent;return z.type==="parallel"&&ht(z).every(function(J){return jt(n.configuration,J)})&&T.push(dt(z.id)),T}));n.exitSet.sort(function(m,T){return T.order-m.order}),n.entrySet.sort(function(m,T){return m.order-T.order});var R=new Set(n.entrySet),D=new Set(n.exitSet),L=Array.from(R).map(function(m){var T=m.onEntry,H=m.activities.map(function(z){return Ee(z)});return X(s?P(P([],x(T),!1),x(H),!1):P(P([],x(H),!1),x(T),!1),h.machine.options.actions)}).concat([w.map(ge)]),I=Array.from(D).map(function(m){return X(P(P([],x(m.onExit),!1),x(m.activities.map(function(T){return Oe(T)})),!1),h.machine.options.actions)}),U=I.concat([X(n.actions,this.machine.options.actions)]).concat(L);if(r){var _=X(j(P([],x(t),!1).sort(function(m,T){return T.order-m.order}).map(function(m){return m.onExit})),this.machine.options.actions).filter(function(m){return m.type!==K&&(m.type!==st||!!m.to&&m.to!==Y.Internal)});return U.concat([_])}return U},e.prototype.transition=function(t,r,n,i){t===void 0&&(t=this.initialState);var a=ct(r),o;if(t instanceof V)o=n===void 0?t:this.resolveState(V.from(t,n));else{var s=E(t)?this.resolve(wt(this.getResolvedPath(t))):this.resolve(t),u=n!=null?n:this.machine.context;o=this.resolveState(V.from(s,u))}if(!C&&a.name===yt)throw new Error("An event cannot have the wildcard type ('".concat(yt,"')"));if(this.strict&&!this.events.includes(a.name)&&!er(a.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(a.name,"'"));var f=this._transition(o.value,o,a)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:o,actions:[]},d=vt([],this.getStateNodes(o.value)),c=f.configuration.length?vt(d,f.configuration):d;return f.configuration=P([],x(c),!1),this.resolveTransition(f,o,o.context,i,a)},e.prototype.resolveRaisedTransition=function(t,r,n,i){var a,o=t.actions;return t=this.transition(t,r,void 0,i),t._event=n,t.event=n.data,(a=t.actions).unshift.apply(a,P([],x(o),!1)),t},e.prototype.resolveTransition=function(t,r,n,i,a){var o,s,u,f,d=this;a===void 0&&(a=Ot);var c=t.configuration,h=!r||t.transitions.length>0,p=h?t.configuration:r?r.configuration:[],y=jt(p,this),g=h?Er(this.machine,c):void 0,S=r?r.historyValue?r.historyValue:t.source?this.machine.historyValue(r.value):void 0:void 0,A=this.getActions(new Set(p),y,t,n,a,r,i),v=r?l({},r.activities):{};try{for(var w=b(A),R=w.next();!R.done;R=w.next()){var D=R.value;try{for(var L=(u=void 0,b(D)),I=L.next();!I.done;I=L.next()){var U=I.value;U.type===Ft?v[U.activity.id||U.activity.type]=U:U.type===$t&&(v[U.activity.id||U.activity.type]=!1)}}catch(M){u={error:M}}finally{try{I&&!I.done&&(f=L.return)&&f.call(L)}finally{if(u)throw u.error}}}}catch(M){o={error:M}}finally{try{R&&!R.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}var _=x(Pt(this,r,n,a,A,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),m=_[0],T=_[1],H=x(rr(m,function(M){return M.type===K||M.type===st&&M.to===Y.Internal}),2),z=H[0],J=H[1],nt=m.filter(function(M){var at;return M.type===Ft&&((at=M.activity)===null||at===void 0?void 0:at.type)===mt}),Ir=nt.reduce(function(M,at){return M[at.activity.id]=xr(at.activity,d.machine,T,a),M},r?l({},r.children):{}),Lt=new V({value:g||r.value,context:T,_event:a,_sessionid:r?r._sessionid:null,historyValue:g?S?nr(S,g):void 0:r?r.historyValue:void 0,history:!g||t.source?r:void 0,actions:g?J:[],activities:g?v:r?r.activities:{},events:[],configuration:p,transitions:t.transitions,children:Ir,done:y,tags:Ie(p),machine:this}),He=n!==T;Lt.changed=a.name===_t||He;var it=Lt.history;it&&delete it.history;var ze=!y&&(this._transient||c.some(function(M){return M._transient}));if(!h&&(!ze||a.name===tt))return Lt;var G=Lt;if(!y)for(ze&&(G=this.resolveRaisedTransition(G,{type:te},a,i));z.length;){var Mr=z.shift();G=this.resolveRaisedTransition(G,Mr._event,a,i)}var Fr=G.changed||(it?!!G.actions.length||He||typeof it.value!=typeof G.value||!Me(G.value,it.value):void 0);return G.changed=Fr,G.history=it,G},e.prototype.getStateNode=function(t){if(rt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[t];if(!r)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return r},e.prototype.getStateNodeById=function(t){var r=rt(t)?t.slice(Yt.length):t;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&rt(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var r=zt(t,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},e.prototype.resolve=function(t){var r,n=this;if(!t)return this.initialStateValue||et;switch(this.type){case"parallel":return ft(this.initialStateValue,function(a,o){return a?n.getStateNode(o).resolve(t[o]||a):et});case"compound":if(E(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(r={},r[t]=i.initialStateValue,r):t}return Object.keys(t).length?ft(t,function(a,o){return a?n.getStateNode(o).resolve(a):et}):this.initialStateValue||{};default:return t||et}},e.prototype.getResolvedPath=function(t){if(rt(t)){var r=this.machine.idMap[t.slice(Yt.length)];if(!r)throw new Error("Unable to find state node '".concat(t,"'"));return r.path}return zt(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=ue(this.states,function(n){return n.initialStateValue||et},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=Tt(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,r){this._init();var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,entrySet:P([],x(n),!1),exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var r=this.config;E(r.target)?t=rt(r.target)?wt(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:t=r.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,r,n){return n===void 0&&(n=!0),n?t.type==="history"?t.resolveHistory(r):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(Tt(this))return[this];if(this.type==="compound"&&!this.initial)return C||q(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=xt(this.initialStateValue);return j(r.map(function(n){return t.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var r=x(t),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var a=this.getStateNode(n);if(a.type==="history")return a.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},e.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:ue(this.states,function(r,n){if(!t)return r.historyValue();var i=E(t)?void 0:t[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},e.prototype.resolveHistory=function(t){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!t){var i=this.target;return i?j(xt(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var a=tr(n.path,"states")(t).current;return E(a)?[n.getStateNode(a)]:j(xt(a).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,r=j(Object.keys(this.states).map(function(n){return t.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,r,n,i;if(this.__cache.events)return this.__cache.events;var a=this.states,o=new Set(this.ownEvents);if(a)try{for(var s=b(Object.keys(a)),u=s.next();!u.done;u=s.next()){var f=u.value,d=a[f];if(d.states)try{for(var c=(n=void 0,b(d.events)),h=c.next();!h.done;h=c.next()){var p=h.value;o.add("".concat(p))}}catch(y){n={error:y}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}}}catch(y){t={error:y}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var r=this;if(t!==void 0)return t.map(function(n){if(!E(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var a=i?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(a);return o}catch(s){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(s.message))}else return r.getStateNodeByPath(a)})},e.prototype.formatTransition=function(t){var r=this,n=ar(t.target),i="internal"in t?t.internal:n?n.some(function(u){return E(u)&&u[0]===r.delimiter}):!0,a=this.machine.options.guards,o=this.resolveTarget(n),s=l(l({},t),{actions:X(k(t.actions)),cond:he(t.cond,a),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return l(l({},s),{target:s.target?s.target.map(function(u){return"#".concat(u.id)}):void 0,source:"#".concat(r.id)})}});return s},e.prototype.formatTransitions=function(){var t,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var a=this.config.on,o=yt,s=a[o],u=s===void 0?[]:s,f=Mt(a,[typeof o=="symbol"?o:o+""]);i=j(Object.keys(f).map(function(v){!C&&v===tt&&q(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var w=Q(v,f[v]);return C||Dr(n,v,w),w}).concat(Q(yt,u)))}var d=this.config.always?Q("",this.config.always):[],c=this.config.onDone?Q(String(dt(this.id)),this.config.onDone):[];C||q(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var h=j(this.invoke.map(function(v){var w=[];return v.onDone&&w.push.apply(w,P([],x(Q(String(Te(v.id)),v.onDone)),!1)),v.onError&&w.push.apply(w,P([],x(Q(String(je(v.id)),v.onError)),!1)),w})),p=this.after,y=j(P(P(P(P([],x(c),!1),x(h),!1),x(i),!1),x(d),!1).map(function(v){return k(v).map(function(w){return n.formatTransition(w)})}));try{for(var g=b(p),S=g.next();!S.done;S=g.next()){var A=S.value;y.push(A)}}catch(v){t={error:v}}finally{try{S&&!S.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}return y},e}(),Ce=!1;function _e(e,t){return!C&&!e.predictableActionArguments&&!Ce&&(Ce=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Nr(e,t)}var F=Pe,Xt=W;const Nt={progress:null,loaded:0,error:null,bucketId:void 0,file:void 0,id:void 0},ke=()=>_e({predictableActionArguments:!0,schema:{context:{},events:{}},tsTypes:{},context:{...Nt},initial:"idle",on:{DESTROY:{actions:"sendDestroy",target:"stopped"}},states:{idle:{on:{ADD:{actions:"addFile"},UPLOAD:{cond:"hasFile",target:"uploading"}}},uploading:{entry:"resetProgress",on:{UPLOAD_PROGRESS:{actions:["incrementProgress","sendProgress"]},UPLOAD_DONE:"uploaded",UPLOAD_ERROR:"error",CANCEL:"idle"},invoke:{src:"uploadFile"}},uploaded:{entry:["setFileMetadata","sendDone"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},error:{entry:["setError","sendError"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},stopped:{type:"final"}}},{guards:{hasFile:(e,t)=>!!e.file||!!t.file},actions:{incrementProgress:F({loaded:(e,{loaded:t})=>t,progress:(e,{progress:t})=>t}),setFileMetadata:F({id:(e,{id:t})=>t,bucketId:(e,{bucketId:t})=>t,progress:e=>100}),setError:F({error:(e,{error:t})=>t}),sendProgress:()=>{},sendError:()=>{},sendDestroy:()=>{},sendDone:()=>{},resetProgress:F({progress:e=>null,loaded:e=>0}),resetContext:F(e=>Nt),addFile:F({file:(e,{file:t})=>t,bucketId:(e,{bucketId:t})=>t,id:(e,{id:t})=>t})},services:{uploadFile:(e,t)=>r=>{const n=t.file||e.file,i=new Qt;i.append("file",n);let a=0;return Bt(t.url,i,{fileId:t.id||e.id,bucketId:t.bucketId||e.bucketId,accessToken:t.accessToken,adminSecret:t.adminSecret,name:t.name||n.name,onUploadProgress:o=>{const s=o.total?Math.round(o.loaded*n.size/o.total):0,u=s-a;a=s,r({type:"UPLOAD_PROGRESS",progress:o.total?Math.round(s*100/o.total):0,loaded:s,additions:u})}}).then(({fileMetadata:o,error:s})=>{if(s&&r({type:"UPLOAD_ERROR",error:s}),o){const{id:u,bucketId:f}=o;r({type:"UPLOAD_DONE",id:u,bucketId:f})}}),()=>{}}}}),{pure:Wt,sendParent:Rt}=mr,Rr=()=>_e({id:"files-list",schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,context:{progress:null,files:[],loaded:0,total:0},initial:"idle",on:{UPLOAD:{cond:"hasFileToDownload",actions:"addItem",target:"uploading"},ADD:{actions:"addItem"},REMOVE:{actions:"removeItem"}},states:{idle:{entry:["resetProgress","resetLoaded","resetTotal"],on:{CLEAR:{actions:"clearList",target:"idle"}}},uploading:{entry:["upload","startProgress","resetLoaded","resetTotal"],on:{UPLOAD_PROGRESS:{actions:["incrementProgress"]},UPLOAD_DONE:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],UPLOAD_ERROR:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],CANCEL:{actions:"cancel",target:"idle"}}},uploaded:{entry:"setUploaded",on:{CLEAR:{actions:"clearList",target:"idle"}}},error:{on:{CLEAR:{actions:"clearList",target:"idle"}}}}},{guards:{hasFileToDownload:(e,t)=>e.files.some(r=>r.getSnapshot().matches("idle"))||!!t.files,isAllUploaded:e=>e.files.every(t=>{var r;return(r=t.getSnapshot())==null?void 0:r.matches("uploaded")}),isAllUploadedOrError:e=>e.files.every(t=>{const r=t.getSnapshot();return(r==null?void 0:r.matches("error"))||(r==null?void 0:r.matches("uploaded"))})},actions:{incrementProgress:F((e,t)=>{const r=e.loaded+t.additions,n=Math.round(r*100/e.total);return{...e,loaded:r,progress:n}}),setUploaded:F({progress:e=>100,loaded:({files:e})=>e.map(t=>t.getSnapshot()).filter(t=>t.matches("uploaded")).reduce((t,r)=>{var n;return t+((n=r.context.file)==null?void 0:n.size)},0)}),resetTotal:F({total:({files:e})=>e.map(t=>t.getSnapshot()).filter(t=>!t.matches("uploaded")).reduce((t,r)=>{var n;return t+((n=r.context.file)==null?void 0:n.size)},0)}),resetLoaded:F({loaded:e=>0}),startProgress:F({progress:e=>0}),resetProgress:F({progress:e=>null}),addItem:F((e,{files:t,bucketId:r})=>{const n=t?Array.isArray(t)?t:"item"in t?Array.from(t):[t]:[],i=e.total+n.reduce((o,s)=>o+s.size,0),a=Math.round(e.loaded*100/i);return{files:[...e.files,...n.map(o=>br(ke().withConfig({actions:{sendProgress:Rt((s,{additions:u})=>({type:"UPLOAD_PROGRESS",additions:u})),sendDone:Rt("UPLOAD_DONE"),sendError:Rt("UPLOAD_ERROR"),sendDestroy:Rt("REMOVE")}}).withContext({...Nt,file:o,bucketId:r}),{sync:!0}))],total:i,loaded:e.loaded,progress:a}}),removeItem:F({files:e=>e.files.filter(t=>{var n,i;const r=(n=t.getSnapshot())==null?void 0:n.matches("stopped");return r&&((i=t.stop)==null||i.call(t)),!r})}),clearList:Wt(e=>e.files.map(t=>Xt({type:"DESTROY"},{to:t.id}))),upload:Wt((e,t)=>e.files.map(r=>Xt(t,{to:r.id}))),cancel:Wt(e=>e.files.map(t=>Xt({type:"CANCEL"},{to:t.id})))}}),Lr=async(e,t)=>new Promise(r=>{t.send({type:"UPLOAD",...e}),t.subscribe(n=>{var i;n.matches("error")?r({error:n.context.error,isError:!0,isUploaded:!1}):n.matches("uploaded")&&r({error:null,isError:!1,isUploaded:!0,id:n.context.id,bucketId:n.context.id,name:(i=n.context.file)==null?void 0:i.name})})}),Ur=async(e,t)=>new Promise(r=>{t.send({type:"UPLOAD",...e,files:e.files}),t.onTransition(n=>{n.matches("error")?r({errors:n.context.files.filter(i=>{var a;return(a=i.getSnapshot())==null?void 0:a.context.error}),isError:!0,files:[]}):n.matches("uploaded")&&r({errors:[],isError:!1,files:n.context.files})})});$.HasuraStorageApi=Kt,$.HasuraStorageClient=Je,$.INITIAL_FILE_CONTEXT=Nt,$.appendImageTransformationParameters=It,$.createFileUploadMachine=ke,$.createMultipleFilesUploadMachine=Rr,$.uploadFilePromise=Lr,$.uploadMultipleFilesPromise=Ur,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=hasura-storage-js.umd.js.map
